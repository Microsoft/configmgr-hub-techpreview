<sequence version="3.10"><group name="Execute Task Sequence" description="for more info about these changes see https://www.niallbrady.com/2019/05/21/how-can-i-deploy-windows-with-a-custom-blocksize-using-sccm/" continueOnError="true"><group name="Initialization" description=""><group name="Prepare variables for VMWare ParaVirtual" description=""><condition><operator type="or"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_ComputerSystem where Model like "Virtual Machine"</variable></expression><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">SELECT * FROM Win32_ComputerSystem WHERE model like "VMWare%"</variable></expression></operator></condition><step type="SMS_TaskSequence_SetVariableAction" name="Set OSDISK" description="" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "OSDISK=C:" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">OSDISK</variable><variable name="VariableValue" property="VariableValue" hidden="true">C:</variable></defaultVarList></step><step type="SMS_TaskSequence_SetVariableAction" name="Set BlockSize" description="" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "BlockSize=16K" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">BlockSize</variable><variable name="VariableValue" property="VariableValue" hidden="true">16K</variable></defaultVarList></step></group><group name="Partition if necessary" description=""><condition><operator type="and"><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">equals</variable><variable name="Value">TRUE</variable><variable name="Variable">_SMSTSInWinPE</variable></expression><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">OEMMedia</variable><variable name="Variable">_SMSTSMediaType</variable></expression><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_LogicalDisk where DriveType=3 and DeviceID != 'X:' and FileSystem = 'NTFS'</variable></expression></operator></operator></condition><group name="Format custom BlockSize for VMWare ParaVirtual" description=""><condition><operator type="or"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_ComputerSystem where Model like "Virtual Machine"</variable></expression><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">SELECT * FROM Win32_ComputerSystem WHERE model like "VMWare%"</variable></expression></operator></condition><step type="SMS_TaskSequence_RunCommandLineAction" name="Create custom diskpart script" description="" timeout="60" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd.exe /c echo select disk 0 &gt; x:\diskpart.txt &amp;  cmd.exe /c echo clean &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo convert gpt &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition primary size=2048 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=ntfs label="Windows RE Tools" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter="T" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo set id="de94bba4-06d1-4d40-a16a-bfd50179d6ac" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo gpt attributes=0x8000000000000001 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition efi size=1024 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=fat32 label="System" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter="S" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition msr size=128 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition primary &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=ntfs label="OSDisk" unit=%BlockSize% &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter=%OSDISK% &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo list volume &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo exit &gt;&gt; x:\diskpart.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd.exe /c echo select disk 0 &gt; x:\diskpart.txt &amp;  cmd.exe /c echo clean &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo convert gpt &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition primary size=2048 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=ntfs label="Windows RE Tools" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter="T" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo set id="de94bba4-06d1-4d40-a16a-bfd50179d6ac" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo gpt attributes=0x8000000000000001 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition efi size=1024 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=fat32 label="System" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter="S" &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition msr size=128 &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo create partition primary &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo format quick fs=ntfs label="OSDisk" unit=%BlockSize% &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo assign letter=%OSDISK% &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo list volume &gt;&gt; x:\diskpart.txt &amp;  cmd.exe /c echo exit &gt;&gt; x:\diskpart.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Execute diskpart commands" description="" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd.exe /c diskpart /s x:\diskpart.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd.exe /c diskpart /s x:\diskpart.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step></group><group name="Script exists and non-NTFS partitions" description=""><condition><operator type="and"><expression type="SMS_TaskSequence_FileConditionExpression"><variable name="Path">X:\Deploy\Scripts\ZTIConfirmDiskpart.vbs</variable></expression><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_DiskPartition where DiskIndex = 0 and Type&lt;&gt;'Installable File System' and Type&lt;&gt;'NTFS'</variable></expression><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">SELECT * FROM Win32_ComputerSystem WHERE model like "VMWare%"</variable></expression></operator><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_ComputerSystem where Model like "Virtual Machine"</variable></expression></operator></operator></condition><step type="SMS_TaskSequence_RunCommandLineAction" name="Confirmation to Partition Disk" description="" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cscript.exe X:\deploy\scripts\zticonfirmdiskpart.vbs</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe X:\deploy\scripts\zticonfirmdiskpart.vbs</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_SetVariableAction" name="Set Diskpart BIOS Compatibility Mode" description="" disable="true" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "OSDDiskpartBiosCompatibilityMode=TRUE" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">OSDDiskpartBiosCompatibilityMode</variable><variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable></defaultVarList></step><step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk (UEFI)" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">equals</variable><variable name="Value">true</variable><variable name="Variable">_SMSTSBootUEFI</variable></expression></condition><action>osddiskpart.exe</action><defaultVarList><variable name="OSDDiskIndex" property="DiskIndex">0</variable><variable name="OSDDiskType" property="DiskType">BASIC</variable><variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable><variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable><variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable><variable name="OSDPartitions" property="Partitions" hidden="true">4</variable><variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable><variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable><variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable><variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable><variable name="OSDPartitions0Size" property="Partitions0Size">300</variable><variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable><variable name="OSDPartitions0Type" property="Partitions0Type">RECOVERY</variable><variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable><variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows RE Tools</variable><variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable><variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable><variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">FAT32</variable><variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable><variable name="OSDPartitions1Size" property="Partitions1Size">512</variable><variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable><variable name="OSDPartitions1Type" property="Partitions1Type">EFI</variable><variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable"></variable><variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">EFI</variable><variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable><variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable><variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable><variable name="OSDPartitions2Size" property="Partitions2Size">128</variable><variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">MB</variable><variable name="OSDPartitions2Type" property="Partitions2Type">MSR</variable><variable name="OSDPartitions2VolumeLetterVariable" property="Partitions2VolumeLetterVariable"></variable><variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">MSR</variable><variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">true</variable><variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable><variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable><variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable><variable name="OSDPartitions3Size" property="Partitions3Size">100</variable><variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">PERCENT</variable><variable name="OSDPartitions3Type" property="Partitions3Type">PRIMARY</variable><variable name="OSDPartitions3VolumeLetterVariable" property="Partitions3VolumeLetterVariable">OSDTemporaryDrive</variable><variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">OSDisk</variable></defaultVarList></step><step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">true</variable><variable name="Variable">_SMSTSBootUEFI</variable></expression></condition><action>osddiskpart.exe</action><defaultVarList><variable name="OSDDiskIndex" property="DiskIndex">0</variable><variable name="OSDDiskType" property="DiskType">BASIC</variable><variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable><variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable><variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable><variable name="OSDPartitions" property="Partitions" hidden="true">1</variable><variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable><variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable><variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable><variable name="OSDPartitions0Size" property="Partitions0Size">100</variable><variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">PERCENT</variable><variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable><variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable">OSDTemporaryDrive</variable><variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">OSDisk</variable></defaultVarList></step></group><group name="Script does not exist or no partitions" description=""><condition><operator type="and"><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">SELECT * FROM Win32_ComputerSystem WHERE model like "VMWare%"</variable></expression></operator><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_ComputerSystem where Model like "Virtual Machine"</variable></expression></operator><operator type="or"><operator type="not"><expression type="SMS_TaskSequence_FileConditionExpression"><variable name="Path">X:\Deploy\Scripts\ZTIConfirmDiskpart.vbs</variable></expression></operator><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_LogicalDisk where DriveType=3 and DeviceID != 'X:'</variable></expression></operator></operator></operator></condition><step type="SMS_TaskSequence_SetVariableAction" name="Set Diskpart BIOS Compatibility Mode" description="" disable="true" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "OSDDiskpartBiosCompatibilityMode=TRUE" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">OSDDiskpartBiosCompatibilityMode</variable><variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable></defaultVarList></step><step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk (UEFI)" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">equals</variable><variable name="Value">true</variable><variable name="Variable">_SMSTSBootUEFI</variable></expression></condition><action>osddiskpart.exe</action><defaultVarList><variable name="OSDDiskIndex" property="DiskIndex">0</variable><variable name="OSDDiskType" property="DiskType">BASIC</variable><variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable><variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable><variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable><variable name="OSDPartitions" property="Partitions" hidden="true">4</variable><variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable><variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable><variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable><variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable><variable name="OSDPartitions0Size" property="Partitions0Size">300</variable><variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable><variable name="OSDPartitions0Type" property="Partitions0Type">RECOVERY</variable><variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable><variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows RE Tools</variable><variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable><variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable><variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">FAT32</variable><variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable><variable name="OSDPartitions1Size" property="Partitions1Size">512</variable><variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable><variable name="OSDPartitions1Type" property="Partitions1Type">EFI</variable><variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable"></variable><variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">EFI</variable><variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable><variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable><variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable><variable name="OSDPartitions2Size" property="Partitions2Size">128</variable><variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">MB</variable><variable name="OSDPartitions2Type" property="Partitions2Type">MSR</variable><variable name="OSDPartitions2VolumeLetterVariable" property="Partitions2VolumeLetterVariable"></variable><variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">MSR</variable><variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">true</variable><variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable><variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable><variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable><variable name="OSDPartitions3Size" property="Partitions3Size">100</variable><variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">PERCENT</variable><variable name="OSDPartitions3Type" property="Partitions3Type">PRIMARY</variable><variable name="OSDPartitions3VolumeLetterVariable" property="Partitions3VolumeLetterVariable">OSDTemporaryDrive</variable><variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">OSDisk</variable></defaultVarList></step><step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">true</variable><variable name="Variable">_SMSTSBootUEFI</variable></expression></condition><action>osddiskpart.exe</action><defaultVarList><variable name="OSDDiskIndex" property="DiskIndex">0</variable><variable name="OSDDiskType" property="DiskType">BASIC</variable><variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable><variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable><variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable><variable name="OSDPartitions" property="Partitions" hidden="true">1</variable><variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable><variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable><variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable><variable name="OSDPartitions0Size" property="Partitions0Size">100</variable><variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">PERCENT</variable><variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable><variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable">OSDTemporaryDrive</variable><variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">OSDisk</variable></defaultVarList></step></group></group></group><group name="Validation" description=""/><group name="Preinstall" description=""><group name="New Computer Only" description=""><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">equals</variable><variable name="Value">True</variable><variable name="Variable">_SMSTSinWInPE</variable></expression></condition><group name="Format Disk" description=""><condition><operator type="and"><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">OEMMedia</variable><variable name="Variable">_SMSTSMediaType</variable></expression><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">false</variable><variable name="Variable">OSDDiskPart</variable></expression></operator></condition><step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk (UEFI)" description="For UEFI systems" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">notEquals</variable><variable name="Value">OEMMedia</variable><variable name="Variable">_SMSTSMediaType</variable></expression><expression type="SMS_TaskSequence_VariableConditionExpression"><variable name="Operator">equals</variable><variable name="Value">true</variable><variable name="Variable">_SMSTSBootUEFI</variable></expression><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">SELECT * FROM Win32_ComputerSystem WHERE model like "VMWare%"</variable></expression><operator type="not"><expression type="SMS_TaskSequence_WMIConditionExpression"><variable name="Namespace">root\cimv2</variable><variable name="Query">select * from Win32_ComputerSystem where Model like "Virtual Machine"</variable></expression></operator></operator></condition><action>osddiskpart.exe</action><defaultVarList><variable name="OSDDiskIndex" property="DiskIndex">0</variable><variable name="OSDDiskType" property="DiskType">BASIC</variable><variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable><variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable><variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable><variable name="OSDPartitions" property="Partitions" hidden="true">4</variable><variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable><variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable><variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable><variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable><variable name="OSDPartitions0Size" property="Partitions0Size">300</variable><variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable><variable name="OSDPartitions0Type" property="Partitions0Type">RECOVERY</variable><variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable><variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows RE Tools</variable><variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable><variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable><variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">FAT32</variable><variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable><variable name="OSDPartitions1Size" property="Partitions1Size">512</variable><variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable><variable name="OSDPartitions1Type" property="Partitions1Type">EFI</variable><variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable"></variable><variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">EFI</variable><variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable><variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable><variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable><variable name="OSDPartitions2Size" property="Partitions2Size">128</variable><variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">MB</variable><variable name="OSDPartitions2Type" property="Partitions2Type">MSR</variable><variable name="OSDPartitions2VolumeLetterVariable" property="Partitions2VolumeLetterVariable"></variable><variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">MSR</variable><variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">true</variable><variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable><variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable><variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable><variable name="OSDPartitions3Size" property="Partitions3Size">100</variable><variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">PERCENT</variable><variable name="OSDPartitions3Type" property="Partitions3Type">PRIMARY</variable><variable name="OSDPartitions3VolumeLetterVariable" property="Partitions3VolumeLetterVariable">OSDisk</variable><variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">OSDisk</variable></defaultVarList></step></group></group></group></group></sequence>
